import { useCallback } from 'react'
import { useStore } from '../store'

export type Language = 'es' | 'en'

type TranslationValue = string | TranslationDict

interface TranslationDict {
  [key: string]: TranslationValue
}

type Params = Record<string, string | number>

const translations: Record<Language, TranslationDict> = {
  es: {
    common: {
      loading: 'Cargando…',
      language: { es: 'Español', en: 'English' },
      cancel: 'Cancelar',
      clear: 'Limpiar',
      save: 'Guardar',
      add: 'Añadir',
      edit: 'Editar',
      delete: 'Eliminar',
      today: 'Hoy',
      tomorrow: 'Mañana',
      error: 'Error',
      synced: 'Sync',
      notSynced: 'No sync',
      on: 'ON',
      off: 'OFF',
      importJson: 'Importar JSON',
      exportJson: 'Exportar JSON',
      exported: 'Exportado.',
      importedCount: 'Importadas: {{count}}',
      importFailed: 'Importación fallida (JSON inválido o estructura incorrecta).',
      none: '—',
      uncategorized: 'Sin categoría',
      other: 'Otros',
    },
    nav: {
      dashboard: 'Resumen',
      subscriptions: 'Suscripciones',
      calendar: 'Calendario',
      settings: 'Ajustes',
    },
    calendar: {
      title: 'Calendario',
      hint: 'Google Calendar se abre en una pestaña por seguridad (no se puede embeber en el panel).',
      agenda30: 'Agenda · Próximos {{days}} días',
      noUpcoming: 'No hay renovaciones en los próximos {{days}} días.',
      syncProgress: 'Progreso: {{ok}}/{{total}} ok · {{fail}} fail',
    },
    onboarding: {
      title: 'Bienvenido a Subly',
      modalDescription: 'Configura lo básico en 1 minuto y empieza a registrar tus suscripciones.',
      welcomeType1: 'Bienvenido a Subly',
      welcomeType2: 'Tu centro de suscripciones',
      welcomeType3: 'Todo a un vistazo',
      back: 'Atrás',
      next: 'Continuar',
      step1Body: 'Visualiza gastos y renovaciones de un vistazo.',
      step1Tip: 'Puedes cerrar este asistente (×) y volver luego desde Ajustes.',
      step2Body: 'Reúne todas tus suscripciones en un solo lugar: añade servicios, edítalos y controla sus renovaciones.',
      step2ExamplesAria: 'Ejemplos de suscripciones',
      step2MiniFormTitle: 'Así se ve el formulario',
      step2MiniFormNameLabel: 'Nombre',
      step2MiniFormPriceLabel: 'Precio',
      step2MiniFormPeriodLabel: 'Periodicidad',
      step2MiniFormStartDateLabel: 'Fecha de inicio',
      step2MiniFormPeriodMonthly: 'Mensual',
      step2MiniFormPeriodAnnual: 'Anual',
      step2MiniFormSubmit: 'Previsualizar',
      step2MiniFormHelp: 'Previsualización: no se guardará nada.',
      step2MiniFormCreated: 'Listo. Así quedaría al guardarla (previsualización).',

      calendarPortabilityTitle: 'Eventos en tu Google Calendar',
      calendarPortabilityBody: 'Al sincronizar, Subly crea eventos recurrentes en tu cuenta de Google Calendar. Así los verás también en móvil, tablet y otros dispositivos con la misma cuenta.',
      calendarPortabilityBullet1: 'Los eventos quedan en tu calendario, no en servidores del desarrollador.',
      calendarPortabilityBullet2: 'Puedes activar/desactivar la sincronización cuando quieras desde Ajustes.',
      calendarPortabilityBullet3: 'Si eliminas la sincronización, Subly puede borrar sus eventos asociados.',
      previewTitle: 'Vista previa',
      previewBody: 'Una vez añadidas tus suscripciones, controla tus gastos con gráficos y tendencias.',
      previewEmpty: 'Añade al menos 1 suscripción para ver el preview.',
      previewKpiCount: 'Suscripciones',
      previewKpiMonthly: 'Gasto mensual',
      previewKpiNext: 'Próxima renovación',
      previewSlideKpis: 'Resumen rápido',
      previewSlideTop: 'Top suscripciones',
      previewSlideCategories: 'Por categoría',
      previewChartTrendTitle: 'Evolución mensual',
      previewChartCategoriesTitle: 'Por categoría',
      previewExampleLabel: 'Ejemplo',

      integrationsTitle: 'Integraciones con Google',
      integrationsBody: 'Actívalas cuando quieras desde Ajustes. Se pedirá permiso OAuth al usar cada acción.',
      integrationsCalendarTitle: 'Google Calendar',
      integrationsCalendar1: 'Crear/actualizar eventos recurrentes (todo el día) por suscripción.',
      integrationsCalendar2: 'Opcional: calendario dedicado “Subly Subscriptions”.',
      integrationsCalendar3: 'Recordatorios: notificación o email (por defecto o por suscripción).',
      integrationsDriveTitle: 'Google Drive',
      integrationsDrive1: 'Guardar un backup JSON en appDataFolder (carpeta oculta).',
      integrationsDrive2: 'Restaurar una copia anterior cuando lo necesites.',
      integrationsDrive3: 'No se guarda en servidores del desarrollador.',

      goSettings: 'Ir a Ajustes',
    },
    settings: {
      groupGeneral: 'General',
      groupIntegrations: 'Integraciones',
      groupData: 'Datos y mantenimiento',
      groupHelp: 'Ayuda',

      languageTitle: 'Idioma',
      languageDescription: 'Selecciona el idioma de la app.',
      alertsTitle: 'Alertas',
      alertsHint: 'Las alertas se muestran como notificaciones del navegador (si están permitidas).',
      currencyTitle: 'Moneda',
      displayAmounts: 'Mostrar importes',
      displayOriginal: 'Con sus monedas originales',
      displayConvert: 'Convertir a una moneda única',
      baseCurrency: 'Moneda base',
      currencyHint: 'Al convertir a una sola moneda, los totales y gráficos se muestran en la moneda base.',
      googleCalendarTitle: 'Google Calendar',
      googleCalendarBody: 'Se abre en una pestaña nueva.',
      calendarSyncTitle: 'Sincronización',
      calendarDedicatedLabel: 'Usar calendario dedicado para suscripciones',
      calendarDedicatedHint: 'Al activarlo, se crea un calendario dedicado para tus suscripciones.',
      calendarAutoSyncAllLabel: 'Auto-sync de suscripciones',
      calendarAutoSyncAllHint: 'Al guardar cambios en Suscripciones, se intentará sincronizar automáticamente (si ya diste permiso).',
      calendarReminderTitle: 'Notificación por defecto',
      calendarReminderHint: 'Se aplica al sincronizar (crear/actualizar) eventos de suscripciones. 0 días desactiva recordatorios.',
      calendarReminderDaysLabel: 'Días antes',
      calendarReminderMethodLabel: 'Tipo',
      calendarReminderMethodPopup: 'Notificación',
      calendarReminderMethodEmail: 'Email',
      openGoogleCalendar: 'Abrir Google Calendar',

      extensionTitle: 'Extensión',
      floatingButtonLabel: 'Mostrar botón flotante en Google Calendar',
      floatingButtonHint: 'Si lo desactivas, podrás abrir Subly solo desde el icono de la extensión (o el panel lateral si ya está abierto).',

      dataTitle: 'Datos',
      resetLocalLabel: 'Borrar datos locales',
      resetLocalHint: 'Elimina suscripciones y restablece ajustes de este dispositivo. No borra tu copia en Drive ni eventos ya creados en Calendar.',
      resetLocalConfirm: 'Esto borrará tus datos locales (suscripciones y ajustes) en este dispositivo. ¿Continuar?',
      resetLocalDone: 'Datos locales borrados.',

      privacyTitle: 'Permisos',
      privacyBody:
        'Subly guarda tus datos localmente. Si activas sincronización/backup, usa Google OAuth para crear/actualizar eventos en Google Calendar y guardar una copia JSON en Drive (appDataFolder).',
      permissionsHint: 'Permisos: identity (OAuth), storage (guardar estado), sidePanel (UI), y acceso a Google APIs + proveedor de tipos de cambio.',

      googleDisconnectLabel: 'Desconectar Google',
      googleDisconnectHint: 'Revoca el token OAuth y fuerza a pedir permisos de nuevo la próxima vez. No borra eventos de Calendar ni tu backup en Drive.',
      googleDisconnectConfirm: 'Esto desconectará Subly de tu cuenta de Google en este navegador. ¿Continuar?',
      googleDisconnectDone: 'Desconectado. La próxima vez se pedirán permisos de nuevo.',
      googleDisconnectNoToken: 'No hay sesión activa que desconectar.',

      helpTitle: 'Ayuda',
      helpFaqTitle: 'FAQ',
      helpFaqDescription: 'Respuestas rápidas y solución de problemas.',
      helpContactTitle: 'Ponte en contacto con nosotros',
      helpContactDescription: 'Incluye el diagnóstico para resolver incidencias más rápido.',
      helpContactLastBackup: 'Última copia en Drive',
      helpFeedbackTitle: 'Enviar comentarios',
      helpFeedbackDescription: 'Ideas, mejoras, bugs o sugerencias.',
      helpFeedbackPlaceholder: 'Cuéntanos qué mejorarías, qué esperabas que pasase y cómo reproducirlo…',
      helpCopyFeedback: 'Copiar comentario',
      helpFeedbackCopied: 'Comentario copiado.',
      helpFeedbackEmpty: 'Escribe un comentario antes de copiar.',
      helpFeedbackHint: 'Pega el comentario en el email de soporte o en el formulario de la tienda.',
      helpOpenPanelQ: '¿Cómo abro el panel?',
      helpOpenPanelA: 'En Google Calendar puedes usar el botón flotante (si está activado) o hacer clic en el icono de la extensión para abrir el Side Panel.',
      helpDriveQ: '¿Qué se guarda en Drive?',
      helpDriveA: 'Un único archivo JSON en la carpeta oculta appDataFolder (por defecto: subly-state.json).',
      helpCalendarQ: '¿Qué crea en Google Calendar?',
      helpCalendarA: 'Eventos recurrentes (todo el día) para cada suscripción, si sincronizas.',

      helpTroubleshootingQ: 'Solución de problemas',
      helpTroubleshootingA: 'Si algo no funciona, prueba estos pasos:',
      helpTs1: 'Recarga Google Calendar y vuelve a abrir el panel.',
      helpTs2: 'Revisa los toggles de sincronización y el botón flotante en Integraciones.',
      helpTs3: 'Si Drive/Calendar falla, desconecta Google y vuelve a autorizar desde la acción que lo requiera.',

      helpStatusQ: 'Estado',
      helpStatusAutoSync: 'Auto-sync',
      helpStatusDedicated: 'Calendario dedicado',
      helpStatusFloating: 'Botón flotante',
      helpStatusDrive: 'Backup en Drive',
      helpStatusLinked: 'Vinculado',
      helpStatusNotLinked: 'No vinculado',
      helpStatusHint: 'Los cambios se gestionan en Integraciones y Datos y mantenimiento.',

      helpDiagnosticsQ: 'Diagnóstico',
      helpDiagnosticsA: 'Copia un resumen del estado de la app para adjuntarlo en un reporte (no incluye tokens OAuth).',
      helpCopyDiagnostics: 'Copiar diagnóstico',
      helpCopied: 'Diagnóstico copiado.',
      helpCopyFailed: 'No se pudo copiar automáticamente. Copia el texto:',

      helpContactQ: 'Contacto',
      helpContactA:
        'Para soporte, usa el email de soporte indicado en la ficha de Chrome Web Store. Si vas a reportar un problema, adjunta también el Diagnóstico.',

      helpPrivacyQ: 'Privacidad',
      helpPrivacyA:
        'Tus datos se guardan localmente. Solo si activas integraciones, Subly usa Google OAuth para Calendar y/o guardar un backup JSON en Drive (appDataFolder).',
      helpPrivacyOpen: 'Abrir política de privacidad',

      onboardingTitle: 'Primeros pasos',
      onboardingDescription: 'Puedes volver a ver el onboarding cuando quieras.',
      openOnboarding: 'Ver onboarding de nuevo',
      onboardingOpened: 'Onboarding abierto.',
    },
    drive: {
      title: 'Copia de seguridad',
      body: 'Guarda una copia en tu Google Drive y restaura una copia anterior cuando lo necesites.',
      lastBackup: 'Última copia',
      save: 'Guardar copia',
      restore: 'Restaurar copia',
      saving: 'Guardando…',
      restoring: 'Restaurando…',
      restoreConfirm: 'Esto reemplazará los datos guardados en este dispositivo por la copia de Drive. ¿Quieres continuar?',
      backupSaved: 'Copia guardada en Google Drive.',
      backupSaveFailed: 'No se pudo guardar la copia en Google Drive.',
      backupRestored: 'Datos restaurados desde Google Drive.',
      backupRestoreFailed: 'No se pudo restaurar desde Google Drive.',
    },
    subscriptions: {
      listTitle: 'Listado',
      subtitle: 'Añade, edita y revisa tus suscripciones.',
      addSubscription: 'Añadir suscripción',
      noSubscriptions: 'No hay suscripciones aún.',
      addToCalendar: 'Añadir a Calendar',
      syncAll: 'Sync todas',
      syncing: 'Sincronizando…',
      syncToCalendar: 'Sync con Calendar',
      syncCreate: 'Crear en Calendar',
      syncUpdate: 'Actualizar en Calendar',
      syncOk: 'Sincronizado con Google Calendar.',
      syncFailed: 'Error al sincronizar.',
        reminderInfo: 'La notificación se configura al sincronizar con Google Calendar.',
        remindersTitle: 'Avisos de renovación',
        reminderUseCustom: 'Usar recordatorio personalizado',
        reminderDaysBefore: 'Días antes',
        reminderMethodLabel: 'Tipo',
        reminderMethodPopup: 'Notificación',
        reminderMethodEmail: 'Email',
        reminderSummaryNone: 'No recibirás notificaciones antes de la renovación.',
        reminderSummaryNotificationOne: 'Recibirás una notificación 1 día antes de la renovación.',
        reminderSummaryNotificationMany: 'Recibirás una notificación {{days}} días antes de la renovación.',
        reminderSummaryEmailOne: 'Recibirás un email 1 día antes de la renovación.',
        reminderSummaryEmailMany: 'Recibirás un email {{days}} días antes de la renovación.',
      syncAllDone: 'Sincronización terminada: {{ok}} ok, {{fail}} fallo(s).',
      autoSyncAllOn: 'Auto-sync: Activado',
      autoSyncAllOff: 'Auto-sync: Desactivado',
      autoSyncAllHint: 'Si está activo, los cambios se sincronizan (si ya hay autorización).',
      autoSyncConfirm: '¿Quieres sincronizar todas ahora?',
      editSubscription: 'Editar suscripción',
      addSubscriptionTitle: 'Añadir suscripción',
      searchPlaceholder: 'Buscar…',
      filtersToggle: 'Filtros',
      resultsCount: 'Resultados: {{count}}',
      filterCategory: 'Categoría',
      filterCurrency: 'Moneda',
      filterPeriod: 'Periodo',
      filterMinPrice: 'Precio mín.',
      filterMaxPrice: 'Precio máx.',
      emptyFiltered: 'Sin resultados con los filtros actuales.',
      dueSoon: 'Pronto',
      columnName: 'Suscripción',
      columnPrice: 'Importe',
      columnPeriod: 'Periodo',
      columnStart: 'Inicio',
      columnNext: 'Próximo',
      columnCategory: 'Categoría',
      columnActions: 'Acciones',
      insightsTitle: 'Resumen',
      insightsHint: 'Importes equivalentes en {{currency}}.',
      insightsDueWindow: 'Ventana: {{days}}d',
      insightsCount: 'Suscripciones',
      insightsAvgMonthly: 'Media mensual',
      insightsAvgMonthlyHelper: 'Equivalente en {{currency}}.',
      insightsUpcoming: 'Próximas',
      insightsUpcomingValue: '{{count}}',
      insightsUpcomingHelper: 'Más próxima: {{date}}',
      insightsTopCategory: 'Top categoría',
      insightsTopCategoryHelper: '{{percent}}% del total',
      name: 'Nombre',
      category: 'Categoría',
      categoryPlaceholder: 'Ej: Streaming',
      amount: 'Importe',
      currency: 'Moneda',
      period: 'Periodo',
      startDate: 'Fecha inicio',
      helpIncomplete: 'Completa nombre, importe y fecha.',
      startLabel: 'Inicio',
      nextLabel: 'Próximo',
      renewal: 'Renovación',
      detailsAmount: 'Importe',
      detailsPeriod: 'Periodo',
      periodMonthly: 'Mensual',
      periodQuarterly: 'Trimestral',
      periodSemiannual: 'Semestral',
      periodAnnual: 'Anual',

      toastCreated: 'Suscripción creada.',
      toastUpdated: 'Suscripción actualizada.',
      toastDeleted: 'Suscripción eliminada.',

      deleteConfirm: '¿Eliminar “{{name}}”? También se borrará su evento en Google Calendar si existe.',
      calendarEventDeleted: 'Evento eliminado de Google Calendar.',
      calendarDeleteFailed: 'No se pudo borrar el evento en Google Calendar.',
    },
    dashboard: {
      monthlySpendTitle: 'Gasto mensual (equivalente)',
      noSubscriptionsYet: 'Sin suscripciones aún.',
      fxRatesLabel: 'FX rates',
      fxUpdating: 'actualizando…',
      fxReady: 'reales (cacheadas)',
      fxUnavailable: 'no disponibles (fallback)',
      fxIdle: '—',
      upcomingRenewalsTitle: 'Próximas renovaciones',
      noDataYet: 'No hay datos todavía.',
      chartsTitle: 'Gráficos',
      addSubsToSeeCharts: 'Añade suscripciones para ver gráficos.',
      currencyLabel: 'Moneda: {{cur}}',
      kpiSubscriptions: 'Suscripciones',
      kpiAvgMonthly: 'Media mensual',
      kpiDueSoon: 'Vencen (≤ {{days}}d)',
      kpiTopCategory: 'Top categoría',
      projectionTitle: 'Proyección mensual (últimos 12 meses)',
      annualTopTitle: 'Top gasto anual (estimado)',
      monthlyByCategoryTitle: 'Gasto mensual por categoría (equivalente)',
      distributionTitle: 'Distribución (gasto mensual equivalente)',
      noData: 'Sin datos.',
      csvMonth: 'Mes',
      csvAmount: 'Importe',
      csvCurrency: 'Moneda',
      csvName: 'Nombre',
      csvAnnualAmount: 'Importe anual',
      csvCategory: 'Categoría',
      csvMonthlyEquivalent: 'Equivalente mensual',
    },
  },
  en: {
    common: {
      loading: 'Loading…',
      language: { es: 'Español', en: 'English' },
      cancel: 'Cancel',
      clear: 'Clear',
      save: 'Save',
      add: 'Add',
      edit: 'Edit',
      delete: 'Delete',
      today: 'Today',
      tomorrow: 'Tomorrow',
      error: 'Error',
      synced: 'Synced',
      notSynced: 'Not synced',
      on: 'ON',
      off: 'OFF',
      importJson: 'Import JSON',
      exportJson: 'Export JSON',
      exported: 'Exported.',
      importedCount: 'Imported: {{count}}',
      importFailed: 'Import failed (invalid JSON or wrong structure).',
      none: '—',
      uncategorized: 'Uncategorized',
      other: 'Other',
    },
    nav: {
      dashboard: 'Dashboard',
      subscriptions: 'Subscriptions',
      calendar: 'Calendar',
      settings: 'Settings',
    },
    calendar: {
      title: 'Calendar',
      hint: 'Google Calendar opens in a new tab for safety (it cannot be embedded in the panel).',
      agenda30: 'Agenda · Next {{days}} days',
      noUpcoming: 'No renewals in the next {{days}} days.',
      syncProgress: 'Progress: {{ok}}/{{total}} ok · {{fail}} fail',
    },
    onboarding: {
      title: 'Welcome to Subly',
      modalDescription: 'Set up the basics in 1 minute and start tracking your subscriptions.',
      welcomeType1: 'Welcome to Subly',
      welcomeType2: 'Your subscription hub',
      welcomeType3: 'Everything at a glance',
      back: 'Back',
      next: 'Continue',
      step1Body: 'See spend and upcoming renewals at a glance.',
      step1Tip: 'Tip: you can close this wizard (×) and come back later from Settings.',
      step2Body: 'Keep all your subscriptions in one place: add services, edit them, and track upcoming renewals.',
      step2ExamplesAria: 'Subscription examples',
      step2MiniFormTitle: 'What the form looks like',
      step2MiniFormNameLabel: 'Name',
      step2MiniFormPriceLabel: 'Price',
      step2MiniFormPeriodLabel: 'Billing period',
      step2MiniFormStartDateLabel: 'Start date',
      step2MiniFormPeriodMonthly: 'Monthly',
      step2MiniFormPeriodAnnual: 'Yearly',
      step2MiniFormSubmit: 'Preview',
      step2MiniFormHelp: 'Preview only: nothing will be saved.',
      step2MiniFormCreated: 'Done. This is how it would look when saved (preview).',

      calendarPortabilityTitle: 'Events in your Google Calendar',
      calendarPortabilityBody: 'When you sync, Subly creates recurring events in your Google Calendar account. That way they show up on your phone, tablet, and any device using the same account.',
      calendarPortabilityBullet1: 'Events live in your calendar, not on developer-owned servers.',
      calendarPortabilityBullet2: 'You can enable/disable sync anytime from Settings.',
      calendarPortabilityBullet3: 'If you remove sync, Subly can delete its linked events.',
      previewTitle: 'Preview',
      previewBody: 'Once you add your subscriptions, track your spending with charts and trends.',
      previewEmpty: 'Add at least 1 subscription to see the preview.',
      previewKpiCount: 'Subscriptions',
      previewKpiMonthly: 'Monthly spend',
      previewKpiNext: 'Next renewal',
      previewSlideKpis: 'Quick summary',
      previewSlideTop: 'Top subscriptions',
      previewSlideCategories: 'By category',
      previewChartTrendTitle: 'Monthly trend',
      previewChartCategoriesTitle: 'By category',
      previewExampleLabel: 'Example',

      integrationsTitle: 'Google integrations',
      integrationsBody: 'Enable them anytime from Settings. OAuth permission is requested when you use each action.',
      integrationsCalendarTitle: 'Google Calendar',
      integrationsCalendar1: 'Create/update recurring all-day events per subscription.',
      integrationsCalendar2: 'Optional: dedicated calendar “Subly Subscriptions”.',
      integrationsCalendar3: 'Reminders: notification or email (global default or per subscription).',
      integrationsDriveTitle: 'Google Drive',
      integrationsDrive1: 'Save a JSON backup to appDataFolder (hidden folder).',
      integrationsDrive2: 'Restore a previous backup when needed.',
      integrationsDrive3: 'No developer-owned servers are used for storage.',

      goSettings: 'Go to Settings',
    },
    settings: {
      groupGeneral: 'General',
      groupIntegrations: 'Integrations',
      groupData: 'Data & maintenance',
      groupHelp: 'Help',

      languageTitle: 'Language',
      languageDescription: 'Select the app language.',
      alertsTitle: 'Alerts',
      alertsHint: 'Alerts appear as browser notifications (if allowed).',
      currencyTitle: 'Currency',
      displayAmounts: 'Show amounts',
      displayOriginal: 'In original currencies',
      displayConvert: 'Convert to a single currency',
      baseCurrency: 'Base currency',
      currencyHint: 'When converting to a single currency, totals and charts use the base currency.',
      googleCalendarTitle: 'Google Calendar',
      googleCalendarBody: 'Opens in a new tab.',
      calendarSyncTitle: 'Sync',
      calendarDedicatedLabel: 'Use a dedicated calendar for subscriptions',
      calendarDedicatedHint: 'When enabled, a dedicated calendar for your subscriptions is created.',
      calendarAutoSyncAllLabel: 'Auto-sync subscriptions',
      calendarAutoSyncAllHint: 'When you save changes in Subscriptions, the app will try to sync automatically (if permission is already granted).',
      calendarReminderTitle: 'Default notification',
      calendarReminderHint: 'Applied when syncing (create/update) subscription events. Set 0 days to disable reminders.',
      calendarReminderDaysLabel: 'Days before',
      calendarReminderMethodLabel: 'Type',
      calendarReminderMethodPopup: 'Notification',
      calendarReminderMethodEmail: 'Email',
      openGoogleCalendar: 'Open Google Calendar',

      extensionTitle: 'Extension',
      floatingButtonLabel: 'Show floating button on Google Calendar',
      floatingButtonHint: 'If disabled, you can open Subly from the extension icon (or the side panel if already open).',

      dataTitle: 'Data',
      resetLocalLabel: 'Clear local data',
      resetLocalHint: 'Clears subscriptions and resets settings on this device. It does not delete your Drive backup nor existing Calendar events.',
      resetLocalConfirm: 'This will clear your local data (subscriptions and settings) on this device. Continue?',
      resetLocalDone: 'Local data cleared.',

      privacyTitle: 'Permissions',
      privacyBody:
        'Subly stores your data locally. If you enable sync/backup, it uses Google OAuth to create/update events in Google Calendar and save a JSON backup to Drive (appDataFolder).',
      permissionsHint: 'Permissions: identity (OAuth), storage (save state), sidePanel (UI), plus access to Google APIs and FX rate providers.',

      googleDisconnectLabel: 'Disconnect Google',
      googleDisconnectHint: 'Revokes the OAuth token and forces consent again next time. It does not delete Calendar events nor your Drive backup.',
      googleDisconnectConfirm: 'This will disconnect Subly from your Google account in this browser. Continue?',
      googleDisconnectDone: 'Disconnected. Next time it will ask for permissions again.',
      googleDisconnectNoToken: 'No active session to disconnect.',

      helpTitle: 'Help',
      helpFaqTitle: 'FAQ',
      helpFaqDescription: 'Quick answers and troubleshooting.',
      helpContactTitle: 'Contact us',
      helpContactDescription: 'Include diagnostics to resolve issues faster.',
      helpContactLastBackup: 'Last Drive backup',
      helpFeedbackTitle: 'Send feedback',
      helpFeedbackDescription: 'Ideas, improvements, bugs, or suggestions.',
      helpFeedbackPlaceholder: 'Tell us what you would improve, what you expected, and how to reproduce it…',
      helpCopyFeedback: 'Copy feedback',
      helpFeedbackCopied: 'Feedback copied.',
      helpFeedbackEmpty: 'Write some feedback before copying.',
      helpFeedbackHint: 'Paste it into the support email or the store form.',
      helpOpenPanelQ: 'How do I open the panel?',
      helpOpenPanelA: 'On Google Calendar you can use the floating button (if enabled) or click the extension icon to open the Side Panel.',
      helpDriveQ: 'What is stored in Drive?',
      helpDriveA: 'A single JSON file in the hidden appDataFolder (default: subly-state.json).',
      helpCalendarQ: 'What does it create in Google Calendar?',
      helpCalendarA: 'Recurring all-day events for each subscription, when you sync.',

      helpTroubleshootingQ: 'Troubleshooting',
      helpTroubleshootingA: 'If something is not working, try these quick steps:',
      helpTs1: 'Reload Google Calendar and reopen the panel.',
      helpTs2: 'Check sync toggles and the floating button in Integrations.',
      helpTs3: 'If Drive/Calendar fails, disconnect Google and re-authorize from the action that requires it.',

      helpStatusQ: 'Status',
      helpStatusAutoSync: 'Auto-sync',
      helpStatusDedicated: 'Dedicated calendar',
      helpStatusFloating: 'Floating button',
      helpStatusDrive: 'Drive backup',
      helpStatusLinked: 'Linked',
      helpStatusNotLinked: 'Not linked',
      helpStatusHint: 'Manage these settings in Integrations and Data & maintenance.',

      helpDiagnosticsQ: 'Diagnostics',
      helpDiagnosticsA: 'Copies a small app status summary you can attach to a bug report (does not include OAuth tokens).',
      helpCopyDiagnostics: 'Copy diagnostics',
      helpCopied: 'Diagnostics copied.',
      helpCopyFailed: 'Could not copy automatically. Please copy the text:',

      helpContactQ: 'Contact',
      helpContactA:
        'For support, use the support email listed on the Chrome Web Store page. If you are reporting an issue, include the Diagnostics output too.',

      helpPrivacyQ: 'Privacy',
      helpPrivacyA:
        'Your data is stored locally. Only if you enable integrations, Subly uses Google OAuth for Calendar and/or to store a JSON backup in Drive (appDataFolder).',
      helpPrivacyOpen: 'Open privacy policy',

      onboardingTitle: 'Getting started',
      onboardingDescription: 'You can replay the onboarding anytime.',
      openOnboarding: 'Replay onboarding',
      onboardingOpened: 'Onboarding opened.',
    },
    drive: {
      title: 'Backup',
      body: 'Save a backup to your Google Drive and restore a previous backup when needed.',
      lastBackup: 'Last backup',
      save: 'Save backup',
      restore: 'Restore backup',
      saving: 'Saving…',
      restoring: 'Restoring…',
      restoreConfirm: 'This will replace the data on this device with the Drive backup. Continue?',
      backupSaved: 'Backup saved to Google Drive.',
      backupSaveFailed: 'Could not save the backup to Google Drive.',
      backupRestored: 'Data restored from Google Drive.',
      backupRestoreFailed: 'Could not restore from Google Drive.',
    },
    subscriptions: {
      listTitle: 'List',
      subtitle: 'Add, edit and review your subscriptions.',
      addSubscription: 'Add subscription',
      noSubscriptions: 'No subscriptions yet.',
      addToCalendar: 'Add to Calendar',
      syncAll: 'Sync all',
      syncing: 'Syncing…',
      syncToCalendar: 'Sync to Calendar',
      syncCreate: 'Create in Calendar',
      syncUpdate: 'Update in Calendar',
      syncOk: 'Synced with Google Calendar.',
      syncFailed: 'Sync failed.',
      reminderInfo: 'The notification is configured when syncing with Google Calendar.',
      remindersTitle: 'Renewal alerts',
      reminderUseCustom: 'Use custom reminder',
      reminderDaysBefore: 'Days before',
      reminderMethodLabel: 'Type',
      reminderMethodPopup: 'Notification',
      reminderMethodEmail: 'Email',
      reminderSummaryNone: 'You will not receive notifications before renewal.',
      reminderSummaryNotificationOne: 'You will receive a notification 1 day before renewal.',
      reminderSummaryNotificationMany: 'You will receive a notification {{days}} days before renewal.',
      reminderSummaryEmailOne: 'You will receive an email 1 day before renewal.',
      reminderSummaryEmailMany: 'You will receive an email {{days}} days before renewal.',
      syncAllDone: 'Sync finished: {{ok}} ok, {{fail}} failed.',
      autoSyncAllOn: 'Auto-sync: ON',
      autoSyncAllOff: 'Auto-sync: OFF',
      autoSyncAllHint: 'When enabled, changes will sync (if already authorized).',
      autoSyncConfirm: 'Do you want to sync all now?',
      editSubscription: 'Edit subscription',
      addSubscriptionTitle: 'Add subscription',
      searchPlaceholder: 'Search…',
      filtersToggle: 'Filters',
      resultsCount: 'Results: {{count}}',
      filterCategory: 'Category',
      filterCurrency: 'Currency',
      filterPeriod: 'Period',
      filterMinPrice: 'Min price',
      filterMaxPrice: 'Max price',
      emptyFiltered: 'No results for the current filters.',
      dueSoon: 'Soon',
      columnName: 'Subscription',
      columnPrice: 'Amount',
      columnPeriod: 'Period',
      columnStart: 'Start',
      columnNext: 'Next',
      columnCategory: 'Category',
      columnActions: 'Actions',
      insightsTitle: 'Summary',
      insightsHint: 'Amounts in {{currency}} equivalent.',
      insightsDueWindow: 'Window: {{days}}d',
      insightsCount: 'Subscriptions',
      insightsAvgMonthly: 'Avg monthly',
      insightsAvgMonthlyHelper: 'Equivalent in {{currency}}.',
      insightsUpcoming: 'Upcoming',
      insightsUpcomingValue: '{{count}}',
      insightsUpcomingHelper: 'Next: {{date}}',
      insightsTopCategory: 'Top category',
      insightsTopCategoryHelper: '{{percent}}% of total',
      name: 'Name',
      category: 'Category',
      categoryPlaceholder: 'e.g. Streaming',
      amount: 'Amount',
      currency: 'Currency',
      period: 'Period',
      startDate: 'Start date',
      helpIncomplete: 'Fill name, amount and date.',
      startLabel: 'Start',
      nextLabel: 'Next',
      renewal: 'Renewal',
      detailsAmount: 'Amount',
      detailsPeriod: 'Period',
      periodMonthly: 'Monthly',
      periodQuarterly: 'Quarterly',
      periodSemiannual: 'Semiannual',
      periodAnnual: 'Annual',

      toastCreated: 'Subscription created.',
      toastUpdated: 'Subscription updated.',
      toastDeleted: 'Subscription deleted.',

      deleteConfirm: 'Delete “{{name}}”? Its Google Calendar event will also be deleted if it exists.',
      calendarEventDeleted: 'Google Calendar event deleted.',
      calendarDeleteFailed: 'Could not delete the Google Calendar event.',
    },
    dashboard: {
      monthlySpendTitle: 'Monthly spend (equivalent)',
      noSubscriptionsYet: 'No subscriptions yet.',
      fxRatesLabel: 'FX rates',
      fxUpdating: 'updating…',
      fxReady: 'real (cached)',
      fxUnavailable: 'unavailable (fallback)',
      fxIdle: '—',
      upcomingRenewalsTitle: 'Upcoming renewals',
      noDataYet: 'No data yet.',
      chartsTitle: 'Charts',
      addSubsToSeeCharts: 'Add subscriptions to see charts.',
      currencyLabel: 'Currency: {{cur}}',
      kpiSubscriptions: 'Subscriptions',
      kpiAvgMonthly: 'Avg monthly',
      kpiDueSoon: 'Due (≤ {{days}}d)',
      kpiTopCategory: 'Top category',
      projectionTitle: 'Monthly projection (last 12 months)',
      annualTopTitle: 'Top annual spend (estimated)',
      monthlyByCategoryTitle: 'Monthly spend by category (equivalent)',
      distributionTitle: 'Distribution (monthly equivalent spend)',
      noData: 'No data.',
      csvMonth: 'Month',
      csvAmount: 'Amount',
      csvCurrency: 'Currency',
      csvName: 'Name',
      csvAnnualAmount: 'Annual amount',
      csvCategory: 'Category',
      csvMonthlyEquivalent: 'Monthly equivalent',
    },
  },
}

function getNested(dict: TranslationDict, path: string): TranslationValue | undefined {
  const parts = path.split('.')
  let cursor: TranslationValue = dict
  for (const part of parts) {
    if (typeof cursor !== 'object' || cursor === null) return undefined
    cursor = (cursor as TranslationDict)[part]
    if (cursor === undefined) return undefined
  }
  return cursor
}

function applyParams(template: string, params?: Params): string {
  if (!params) return template
  return template.replace(/\{\{\s*(\w+)\s*\}\}/g, (_, key) => String(params[key] ?? ''))
}

export function translate(language: Language, key: string, params?: Params): string | undefined {
  const dict = translations[language] ?? translations.es
  const value = getNested(dict, key)
  if (typeof value === 'string') return applyParams(value, params)
  return undefined
}

export function useI18n() {
  const { state } = useStore()
  const language: Language = state.settings.language === 'en' ? 'en' : 'es'

  const t = useCallback(
    (key: string, params?: Params) => translate(language, key, params),
    [language],
  )

  return { language, t }
}
